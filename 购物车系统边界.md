# 购物车

## 1，系统边界

	系统边界说明了当前系统所提供的功能集合的明确划分原则，包括他对外提供何种接口、语义，以及逻辑实现中依赖的部分如何切分。如，购物车的部分，我们在购物车里仅处理购物车相关内容，明确不处理商品相关内容等。

	系统边界的用途是明确系统要处理的问题，在系统设计和后续维护中，遵循此原则，使得所有维护者对系统的逻辑理解更容易一致无歧义。


接囗统计：

- 购物车列表
- 向购物车添加商品
- 删除购物车的商品
- 编辑购物车商品属性
- 下单&订单确认



### 1，购物车列表

购物车列表主要有四个数据源

- 购物车主数据：t_bat_shopcart 或 t_bat_shopcart_offline
- 商品数据：商家后台提供数据接囗，包括商品的基本信息和折扣等信息
- 优惠券：用户研发提供数据接囗，商品可以领取到的店铺优惠券
- 满额满件：商家设置的满额满件优惠


对外的数据统一定义在sdoota层，由snake并发的去请求其他模块的数据，sdoota层负责组装各模块返回来的数据。购物车主数据，商品数据，满额满件这三个模块的数据由vdoota的order/shopping_cart_poster接囗给出。优惠券通过coupon系统的coupon/batch_get_shop_coupon_apply给出。这里要注意的是，购物车主数据同商品数据结合的比较紧密，属于嵌入在购物车的数据类里面。


### 2，向购物车添加商品

就是向购物车主表里写入一条记录，写入接囗会判断商品的库存，上下架等基础信息（读取商品信息）。

### 3，删除购物车的商品

将购物车主表里面对应记录的status置为-1，同其他模块无交互。

### 4， 编辑购物车商品属性

更新购物车主表里面的商品属性，检查数据更新的合法性（读取商品信息）。

### 5，下单&订单确认

订单确认和下单时，会根据sid（主表的主键）来获取商品的详细信息。下单成功后，会删除使用到的记录。

## 2，依赖和被依赖关系

	依赖和被依赖关系说明了当前系统所依赖的部分和其他系统依赖本系统的部分。

	如购物车依赖商品、优惠系统，同时阐述清楚和所依赖组件的关系，如通过sku_id/goods_id来获取商品的名称、颜色尺码等信息。

	如下单依赖购物车，其依赖关系是，下单过程中需要从购物车中读取指定用户的goods_id的列表。

	依赖关系的用途，一是和系统边界类似，第二，有助于在架构演进过程中避免踩坑。


- 购物车列表同商品的依赖关系：购物车列表和商品的依赖是最紧密的，以至于在购物车的数据读取类里面直接嵌入了商品数据读取的代码。根据sku_id向商品模块读取sku的详细信息，包括价格，商品名称，库存等。
- 购物车列表同满额满件的依赖关秒：加载完购物车的主信息（包括商品信息）后，会根据shop_id获取商家设置的满额满件的数据。
- 购物车列表同优惠券的依赖关系：根据用户id和购物车商品所属店铺id获取商家所设置的店铺优惠券数据。
- 下单和购物车的依赖关系：购物车下单时会用到购物车的数据，购物车主表里面的每一条记录（以sid为主键的一条记录）表示一个sku，在订单确认页面或提交订单都会根据sid来获取商品的价格，库存，上下架等数据（实际上，会根据sid再去商品系统取一下数据）。下单完成后，系统会删除掉使用到的sid记录。



